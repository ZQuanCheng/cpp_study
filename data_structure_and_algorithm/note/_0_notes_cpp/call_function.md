# 函数调用的执行过程





> 



> **什么是栈帧**
>
> https://blog.csdn.net/qq_56713382/article/details/124213641
> 
> >  
> > 当程序在运行时，每个函数每次调用都会在调用栈上维护一个独立的栈帧，栈帧中维持着函数所需的各种信息。
> >  
> > 栈帧也叫过程活动记录，是编译器用来实现过程/函数调用的一种数据结构。
> >  
> > 从逻辑上来说，栈帧就是一个函数的执行环境，它一般包括：
> > 
> > 1.函数参数
> > 
> > 2.函数的返回地址
> > 
> > 3.函数的非静态局部变量
> > 
> > 4.编译器自动生成的临时变量
> > 
> > 5.函数调用的上下文
> > 
> > 
> 
> 
> <font color="yellow"> 栈是由高地址向低地址生长的</font> 
>
> > 编译器通常使用寄存器`ebp`指向当前栈帧的`底部(高地址)`
> > 
> > 使用寄存器`esp`指向当前栈帧的`顶部(低地址)`
>
> 
>





> https://blog.csdn.net/weixin_43971373/article/details/119729765
>
> **函数调用**
>
> 例如: `int func(int param1 ,int param2,int param3)`
> 
> > 1. main中的参数入栈，将参数按照函数调用约定依次压入栈中
> > 
> > 2. 实参入栈
> > 
> > 3. 返回地址RET入栈（返回地址RET：当前指令的下一条指令的地址入栈）
> > 
> > 4. 根据函数名找到函数入口，跳转
> > 
> > 5. 开辟新的栈帧，当前的`ebp`存储的栈底地址压栈
> > 
> > > 
> > > 当前的`ebp`指针指向地址压栈
> > > 
> > > 将`esp`的值赋给`ebp`, `ebp = esp`
> > > 
> > > 之后只移动`esp`, 更新栈顶
> 
> 
> 
> **函数体执行**
>
> 
> > 
> > 6. 函数内局部变量入栈
> > > 
> > > 通过`EBP`指针减法运算，
> > > 
> > > 例如`[EBP+0x8]`(即第一个实参`param1`，`+`是高地址，是已经存放过的；`-`是低地址，地址是待使用的)，将该实参的值存入`EAX`寄存器；然后把`EAX`的中的值放到`[EBP-4]`这个地址里，创建局部变量
> > > 
> > 
> > 
> > 
> > 将函数体中的变量、保存到栈中的实参值，依次从栈中取出，释放栈空间（出栈）。
> 
> **返回**
> > 
> > 将函数返回值保存到`eax`寄存器
> > 
> > 局部变量出栈，`esp`更新
> > 
> > 根据栈顶的`EBP原值`，恢复`ebp`，即回到上一个栈帧
> > 
> > 按照剩余栈元素，返回地址`RET`，释放栈空间
> > 
> > 
>
> 














